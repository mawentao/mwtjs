define("er/ajax",function(require){var e={};return require("./Observable").enable(e),e.hooks={},e.hooks.serializeArray=function(t,r){for(var n=t?encodeURIComponent(t):"",o=[],i=0;i<r.length;i++){var s=r[i];o[i]=e.hooks.serializeData("",s)}return n?n+"="+o.join(","):o.join(",")},e.hooks.serializeData=function(t,r){1===arguments.length&&(r=t,t=""),null==r&&(r="");var n=e.hooks.serializeData.getKey,o=t?encodeURIComponent(t):"",i=Object.prototype.toString.call(r);switch(i){case"[object Array]":return e.hooks.serializeArray(t,r);case"[object Object]":var s=[];for(var a in r){var u=n(a,t),c=e.hooks.serializeData(u,r[a]);s.push(c)}return s.join("&");default:return o?o+"="+encodeURIComponent(r):encodeURIComponent(r)}},e.hooks.serializeData.getKey=function(e,t){return t?t+"."+e:e},e.config={cache:!1,timeout:0,charset:""},e.request=function(t){"function"==typeof e.hooks.beforeExecute&&e.hooks.beforeExecute(t);var r=require("./assert");r.hasProperty(t,"url","url property is required");var n={method:"POST",data:{},cache:e.config.cache,timeout:e.config.timeout,charset:e.config.charset},o=require("./util");t=o.mix(n,t);var i=require("./Deferred"),s=new i;if("function"==typeof e.hooks.beforeCreate){var a=e.hooks.beforeCreate(t,s);if(a===!0){var u=s.promise;return u.abort=function(){},u.setRequestHeader=function(){},u}}var c=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),u=s.promise,p={abort:function(){c.onreadystatechange=null,c.abort(),u.status=0,u.readyState=c.readyState,u.responseText="",u.responseXML="",s.reject(u)},setRequestHeader:function(e,t){c.setRequestHeader(e,t)}};o.mix(u,p),u.then(function(){e.fire("done",{xhr:u})},function(){e.fire("fail",{xhr:u})}),c.onreadystatechange=function(){if(4===c.readyState){var r=u.status||c.status;if(0===r?r=200:1223===r&&(r=204),u.status=u.status||r,u.readyState=c.readyState,u.responseText=c.responseText,u.responseXML=c.responseXML,"function"==typeof e.hooks.afterReceive&&e.hooks.afterReceive(u,t),200>r||r>=300&&304!==r)return s.reject(u),void 0;var n=c.responseText;if("json"===t.dataType)try{n=o.parseJSON(n)}catch(i){return u.error=i,s.reject(u),void 0}if("function"==typeof e.hooks.afterParse)try{n=e.hooks.afterParse(n,u,t)}catch(i){return u.error=i,s.reject(u),void 0}s.resolve(n)}};var l=t.method.toUpperCase(),f={};"GET"===l&&o.mix(f,t.data),t.cache===!1&&(f._=+new Date);var h=e.hooks.serializeData("",f,"application/x-www-form-urlencoded"),d=t.url;if(h){var v=d.indexOf("?")>=0?"&":"?";d+=v+h}if(c.open(l,d,!0),"function"==typeof e.hooks.beforeSend&&e.hooks.beforeSend(u,t),"GET"===l)c.send();else{var y=t.contentType||"application/x-www-form-urlencoded";t.charset&&(y+=";charset="+t.charset),c.setRequestHeader("Content-Type",y);var h=e.hooks.serializeData("",t.data,y,u);c.send(h)}if(t.timeout>0){var g=setTimeout(function(){u.status=408,u.abort()},t.timeout);u.ensure(function(){clearTimeout(g)})}return u},e.get=function(t,r,n){var o={method:"GET",url:t,data:r,cache:n||e.config.cache};return e.request(o)},e.getJSON=function(t,r,n){var o={method:"GET",url:t,data:r,dataType:"json",cache:n||e.config.cache};return e.request(o)},e.post=function(t,r,n){var o={method:"POST",url:t,data:r,dataType:n||"json"};return e.request(o)},e.log=function(t,r){var n=new Image,o=window.ER_LOG_POOL||(window.ER_LOG_POOL={}),i=+new Date;o[i]=n,n.onload=n.onerror=n.onabort=function(){n.onload=n.onerror=n.onabort=null,o[i]=null,n=null};var s=e.hooks.serializeData("",r,"application/x-www-form-urlencoded");if(s){var a=t.indexOf("?")>=0?":":"?";t+=a+s}n.src=t},e});