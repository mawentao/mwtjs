define("er/Deferred",function(require){function t(t){function e(){for(var e=0;e<i.length;e++){var n=i[e];n.apply(t.promise,t._args)}}if("pending"!==t.state){var i="resolved"===t.state?t._doneCallbacks.slice():t._failCallbacks.slice();t.syncModeEnabled?e():r(e),t._doneCallbacks=[],t._failCallbacks=[]}}function e(t,e,n,o){return function(){if("function"==typeof n){var r=e.resolver,s=n.apply(t.promise,arguments);i.isPromise(s)?s.then(r.resolve,r.reject):r.resolve(s)}else e[o].apply(e,t._args)}}function i(){this.state="pending",this._args=null,this._doneCallbacks=[],this._failCallbacks=[],this.promise={done:n.bind(this.done,this),fail:n.bind(this.fail,this),ensure:n.bind(this.ensure,this),then:n.bind(this.then,this)},this.promise.promise=this.promise,this.resolver={resolve:n.bind(this.resolve,this),reject:n.bind(this.reject,this)}}var n=require("./util"),o=require("./assert"),r="function"==typeof window.setImmediate?function(t){window.setImmediate(t)}:function(t){window.setTimeout(t,0)};return require("./Observable").enable(i),i.isPromise=function(t){return t&&"function"==typeof t.then},i.prototype.syncModeEnabled=!1,i.prototype.resolve=function(){"pending"===this.state&&(this.state="resolved",this._args=[].slice.call(arguments),i.fire("resolve",{deferred:this,args:this._args,reason:this._args[0]}),t(this))},i.prototype.reject=function(){"pending"===this.state&&(this.state="rejected",this._args=[].slice.call(arguments),i.fire("reject",{deferred:this,args:this._args,reason:this._args[0]}),t(this))},i.prototype.done=function(t){return this.then(t)},i.prototype.fail=function(t){return this.then(null,t)},i.prototype.ensure=function(t){return this.then(t,t)},i.prototype.then=function(n,o){var r=new i;return r.syncModeEnabled=this.syncModeEnabled,this._doneCallbacks.push(e(this,r,n,"resolve")),this._failCallbacks.push(e(this,r,o,"reject")),t(this),r.promise},i.all=function(){function t(t){s--,o.greaterThanOrEquals(s,0,"workingCount should be positive");var e=[].slice.call(arguments,1);e.length<=1&&(e=e[0]),u[t]=e,0===s&&l[a].apply(l,u)}function e(){a="reject",t.apply(this,arguments)}var r=[].concat.apply([],arguments),s=r.length;if(!s)return i.resolved();for(var a="resolve",u=[],l=new i,p=0;p<r.length;p++){var c=r[p];c.then(n.bind(t,c,p),n.bind(e,c,p))}return l.promise},i.resolved=function(){var t=new i;return t.resolve.apply(t,arguments),t.promise},i.rejected=function(){var t=new i;return t.reject.apply(t,arguments),t.promise},i.require=function(){var t=[].slice.call(arguments),e=new i;return window.require(t,e.resolver.resolve),e.promise.abort=e.resolver.reject,e.promise},i});