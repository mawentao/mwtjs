define("er/Model",function(require){
	function t(t,e){function n(n){return e.dump?t.fill(n,c):t.set(e.name,n,c),{success:!0,name:e.name,options:e,value:n}}function r(t){return{success:!1,name:e.name,options:e,error:t}}var i=e.retrieve(t,e);if(p.isPromise(i))return"function"==typeof i.abort&&t.addPendingWorker(i),i.then(n,function(e){e=r(e);try{var i=t.handleError(e);return n(i)}catch(o){throw o.success===!1?o:r(o)}});var o=n(i);return p.resolved(o)}
	function e(t,e){for(var n=p.resolved(),i=0;i<e.length;i++){var o=e[i],s=u.bind(r,null,t,o);n=n.then(s)}return n}
	function n(t,e){var n=[];for(var i in e)if(e.hasOwnProperty(i)){var o=e[i];"function"==typeof o?o={retrieve:o,name:i}:"function"==typeof o.retrieve&&(o=u.mix({name:i},o)),n.push(r(t,o))}return p.all(n)}
	function r(r,i){if(!i)return p.resolved();if("function"==typeof i){var o={retrieve:i,dump:!0};return t(r,o)}return i instanceof Array?e(r,i):"function"==typeof i.retrieve?t(r,i):n(r,i)}
	function i(t){this.store={},this.pendingWorkers=[],t&&this.fill(t,c)}
	function o(t,e){for(var n=0;n<t.pendingWorkers.length;n++)if(t.pendingWorkers[n]===e)return t.pendingWorkers.splice(n,1),void 0}
	function s(){function t(t){var e={success:!1,name:"$prepare",options:{},error:t};throw e}try{var e=this.prepare();return p.isPromise(e)?e.fail(t):e}catch(n){t(n)}}
	function a(t,e,n){var r=t.store.hasOwnProperty(e)?"change":"add",i=t.store[e];return t.store[e]=n,i!==n?{type:r,name:e,oldValue:i,newValue:n}:null}
	var u=require("./util"),p=require("./Deferred"),c={silent:!0},l=require("./Observable");
	return i.prototype.addPendingWorker=function(t){this.pendingWorkers.push(t),t.ensure(u.bind(o,null,this,t))},i.prototype.datasource=null,i.prototype.load=function(){try{var t=r(this,this.datasource);return t.then(u.bind(s,this))}catch(e){return p.rejected(e)}},i.prototype.prepare=function(){},i.prototype.get=function(t){return this.store[t]},i.prototype.set=function(t,e,n){n=n||{};
	var r=a(this,t,e);if(r&&!n.silent){var i={changes:[r]};this.fire("change",i)}},i.prototype.fill=function(t,e){e=e||{};var n=[];for(var r in t)if(t.hasOwnProperty(r)){var i=a(this,r,t[r]);i&&n.push(i)}if(n.length&&!e.silent){var o={changes:n};this.fire("change",o)}},i.prototype.remove=function(t,e){if(this.store.hasOwnProperty(t)){e=e||{};var n=this.store[t];if(delete this.store[t],!e.silent){var r={changes:[{type:"remove",name:t,oldValue:n,newValue:void 0}]};this.fire("change",r)}return n}},i.prototype.getAsModel=function(t){var e=this.get(t);return e&&"[object Object]"==={}.toString.call(e)?new i(e):new i},i.prototype.valueOf=function(){return u.mix({},this.store)},i.prototype.clone=function(){return new i(this.store)},i.prototype.handleError=function(t){throw t},i.prototype.dispose=function(){for(var t=0;t<this.pendingWorkers.length;t++){var e=this.pendingWorkers[t];if("function"==typeof e.abort)try{e.abort()}catch(n){}}this.pendingWorkers=null},u.inherits(i,l),i
});